steps:

# Analyze Azure resources using PSRule for Azure

- task: ps-rule-assert@2
  displayName: Analyze Azure template files
  continueOnError: true
  inputs:
    modules: 'PSRule.Rules.Azure'
    inputPath: code-test/
    baseline: Azure.Pillar.OperationalExcellence
    outputFormat: Sarif
    outputPath: output/ps-rule-results.sarif 

- task: PowerShell@2
  displayName: 'Run PSRule'
  continueOnError: true
  inputs:
    targetType: 'inline'
    script: |
      Install-Module -Name PSRule.Rules.Azure -Scope CurrentUser -Force
      Invoke-PSRule -inputPath "code-test/" -Module 'PSRule.Rules.Azure'
    
